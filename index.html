<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Redirecting...</title>
</head>
<body>

<h2 style="text-align:center;margin-top:40px;">
Redirecting... Please wait ‚è≥
</h2>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAk7OeIvh-D7NC_QKkQNMria4GxL5fT2ws",
  authDomain: "prime-f23e6.firebaseapp.com",
  databaseURL: "https://prime-f23e6-default-rtdb.firebaseio.com/",
  projectId: "prime-f23e6",
  storageBucket: "prime-f23e6.firebasestorage.app",
  messagingSenderId: "260013125631",
  appId: "1:260013125631:web:5f1371b9d359b68b9181ca"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Get URL parameter
const params = new URLSearchParams(window.location.search);
const targetUrl = params.get("url");

// Device detect
function getDevice(){
  const ua = navigator.userAgent;
  if(/mobile/i.test(ua)) return "Mobile";
  if(/tablet/i.test(ua)) return "Tablet";
  return "Desktop";
}

// Get Country
fetch("https://ipapi.co/json/")
.then(res => res.json())
.then(data => {

  push(ref(db, 'universal_clicks'), {
    time: Date.now(),
    target: targetUrl,
    country: data.country_name,
    city: data.city,
    ip: data.ip,
    device: getDevice(),
    userAgent: navigator.userAgent
  });

  // Redirect after saving
  setTimeout(()=>{
    window.location.href = targetUrl;
  }, 1000);

});

</script>

</body>
</html>
